<div class="clients-page">
  <div class="header">
    <div>
      <h1>Clients</h1>
      <p>Manage your client companies and relationships</p>
    </div>
    <button class="btn-primary" (click)="openAddModal()">
      <span>â•</span> Add Client
    </button>
  </div>

  <div class="filters">
    <div class="search-bar">
      <span class="icon">ğŸ”</span>
      <input type="text" placeholder="Search clients..." [(ngModel)]="searchQuery">
    </div>
    <select [(ngModel)]="selectedIndustry">
      <option value="all">All Industries</option>
      <option value="Technology">Technology</option>
      <option value="Finance">Finance</option>
      <option value="Healthcare">Healthcare</option>
      <option value="Retail">Retail</option>
      <option value="Education">Education</option>
    </select>
    <select [(ngModel)]="selectedStatus">
      <option value="all">All Status</option>
      <option value="Active">Active</option>
      <option value="Inactive">Inactive</option>
    </select>
  </div>

  <div class="table-container">
    <table class="data-table">
      <thead>
        <tr>
          <th>Client Name</th>
          <th>Industry</th>
          <th>Contact</th>
          <th>Active Jobs</th>
          <th>Total Hires</th>
          <th>Status</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let client of paginatedClients" (click)="viewClient(client.id)">
          <td>
            <div class="name-cell">
              <span class="logo">{{ client.logo }}</span>
              <strong>{{ client.name }}</strong>
            </div>
          </td>
          <td>{{ client.industry }}</td>
          <td>
            <div>{{ client.contactPerson || client.contact }}</div>
            <div class="email-small">{{ client.email }}</div>
          </td>
          <td>{{ client.activeJobs }}</td>
          <td>{{ client.totalHires }}</td>
          <td><span class="badge" [class.active]="client.status === 'Active'" [class.inactive]="client.status === 'Inactive'">{{ client.status }}</span></td>
          <td>
            <div class="action-buttons">
              <button class="btn-action" [routerLink]="['/clients', client.id]" (click)="$event.stopPropagation()" title="View Details">ğŸ“‹</button>
              <button class="btn-action" (click)="editClient(client.id); $event.stopPropagation()" title="Edit Client">âœï¸</button>
              <button class="btn-action" (click)="sendEmail(client.id); $event.stopPropagation()" title="Email Client">âœ‰ï¸</button>
              <button class="btn-action" (click)="viewJobs(client.id); $event.stopPropagation()" title="View Jobs">ğŸ’¼</button>
              <button class="btn-action" (click)="addNote(client.id); $event.stopPropagation()" title="Add Note">ğŸ“</button>
              <button class="btn-action" (click)="viewDocuments(client.id); $event.stopPropagation()" title="View Documents">ğŸ“„</button>
              <button class="btn-action" (click)="viewContracts(client.id); $event.stopPropagation()" title="View Contracts">ğŸ“œ</button>
              <button class="btn-action danger" (click)="deactivateClient(client.id); $event.stopPropagation()" title="Deactivate" *ngIf="client.status === 'Active'">ğŸš«</button>
              <button class="btn-action success" (click)="activateClient(client.id); $event.stopPropagation()" title="Activate" *ngIf="client.status === 'Inactive'">âœ…</button>
            </div>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="pagination">
    <div class="pagination-info">
      Showing {{ startIndex + 1 }} to {{ endIndex }} of {{ totalClients }} clients
    </div>
    <div class="pagination-controls">
      <select [(ngModel)]="itemsPerPage" (change)="onItemsPerPageChange()">
        <option [value]="25">25 per page</option>
        <option [value]="50">50 per page</option>
        <option [value]="100">100 per page</option>
      </select>
      <button [disabled]="currentPage === 1" (click)="previousPage()">Previous</button>
      <span class="page-numbers">
        <button *ngFor="let page of pageNumbers" 
                [class.active]="page === currentPage" 
                (click)="goToPage(page)">{{ page }}</button>
      </span>
      <button [disabled]="currentPage === totalPages" (click)="nextPage()">Next</button>
    </div>
  </div>

  <div class="clients-grid" style="display: none;">
    <div class="client-card" *ngFor="let client of filteredClients" [routerLink]="['/clients', client.id]">
      <div class="card-header">
        <div class="logo">{{ client.logo }}</div>
        <div class="info">
          <h3>{{ client.name }}</h3>
          <span class="industry">{{ client.industry }}</span>
        </div>
        <span class="status" [class.active]="client.status === 'Active'" [class.inactive]="client.status === 'Inactive'">
          {{ client.status }}
        </span>
      </div>

      <div class="stats">
        <div class="stat">
          <span class="value">{{ client.activeJobs }}</span>
          <span class="label">Active Jobs</span>
        </div>
        <div class="stat">
          <span class="value">{{ client.totalHires }}</span>
          <span class="label">Total Hires</span>
        </div>
      </div>

      <div class="contact">
        <div class="contact-info">
          <span class="icon">ğŸ‘¤</span>
          <div>
            <div class="name">{{ client.contactPerson || client.contact }}</div>
            <div class="email">{{ client.email }}</div>
          </div>
        </div>
        <div class="phone">ğŸ“ {{ client.phone }}</div>
      </div>

      <div class="footer">
        <span class="since">Client since {{ client.since | date:'MMM yyyy' }}</span>
        <button class="btn-link">View Details â†’</button>
      </div>
    </div>
  </div>

  <!-- Edit Client Modal -->
  <div class="modal-overlay" *ngIf="showEditModal" (click)="closeEditModal()">
    <div class="modal" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h2>Edit Client</h2>
        <button class="close-btn" (click)="closeEditModal()">âœ•</button>
      </div>
      <div class="modal-body">
        <div class="form-group">
          <label>Company Name *</label>
          <input type="text" [(ngModel)]="newClient.name" class="form-control">
        </div>
        <div class="form-group">
          <label>Industry *</label>
          <select [(ngModel)]="newClient.industry" class="form-control">
            <option value="Technology">Technology</option>
            <option value="Finance">Finance</option>
            <option value="Healthcare">Healthcare</option>
            <option value="Retail">Retail</option>
            <option value="Education">Education</option>
          </select>
        </div>
        <div class="form-group">
          <label>Contact Person</label>
          <input type="text" [(ngModel)]="newClient.contact" class="form-control">
        </div>
        <div class="form-group">
          <label>Email *</label>
          <input type="email" [(ngModel)]="newClient.email" class="form-control">
        </div>
        <div class="form-group">
          <label>Phone</label>
          <input type="tel" [(ngModel)]="newClient.phone" class="form-control">
        </div>
        <div class="form-group">
          <label>Address</label>
          <input type="text" [(ngModel)]="newClient.address" class="form-control" placeholder="Company address">
        </div>
        <div class="form-group">
          <label>Website</label>
          <input type="url" [(ngModel)]="newClient.website" class="form-control" placeholder="https://company.com">
        </div>
        <div class="form-group">
          <label>About</label>
          <textarea [(ngModel)]="newClient.description" class="form-control" rows="3" placeholder="Company description"></textarea>
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn-secondary" (click)="closeEditModal()">Cancel</button>
        <button class="btn-primary" (click)="updateClient()">Update Client</button>
      </div>
    </div>
  </div>

  <!-- Add Note Modal -->
  <div class="modal-overlay" *ngIf="showNoteModal" (click)="closeNoteModal()">
    <div class="modal" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h2>Add Note for {{ selectedClient?.name }}</h2>
        <button class="close-btn" (click)="closeNoteModal()">âœ•</button>
      </div>
      <div class="modal-body">
        <div class="form-group">
          <label>Note</label>
          <textarea [(ngModel)]="noteText" class="form-control" rows="6" placeholder="Enter your note here..."></textarea>
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn-secondary" (click)="closeNoteModal()">Cancel</button>
        <button class="btn-primary" (click)="saveNote()">Save Note</button>
      </div>
    </div>
  </div>

  <!-- Email Modal -->
  <div class="modal-overlay" *ngIf="showEmailModal" (click)="closeEmailModal()">
    <div class="modal" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h2>Send Email to {{ selectedClient?.name }}</h2>
        <button class="close-btn" (click)="closeEmailModal()">âœ•</button>
      </div>
      <div class="modal-body">
        <div class="form-group">
          <label>To</label>
          <input type="email" [(ngModel)]="emailData.to" class="form-control" readonly>
        </div>
        <div class="form-group">
          <label>Subject *</label>
          <input type="text" [(ngModel)]="emailData.subject" class="form-control" placeholder="Email subject">
        </div>
        <div class="form-group">
          <label>Message *</label>
          <textarea [(ngModel)]="emailData.body" class="form-control" rows="8" placeholder="Enter your message..."></textarea>
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn-secondary" (click)="closeEmailModal()">Cancel</button>
        <button class="btn-primary" (click)="sendEmailMessage()" [disabled]="sending">{{ sending ? 'Sending...' : 'Send Email' }}</button>
      </div>
    </div>
  </div>

  <!-- Add Client Modal -->
  <div class="modal-overlay" *ngIf="showAddModal" (click)="closeAddModal()">
    <div class="modal" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h2>Add New Client</h2>
        <button class="close-btn" (click)="closeAddModal()">âœ•</button>
      </div>
      <div class="modal-body">
        <div class="form-group">
          <label>Company Name *</label>
          <input type="text" [(ngModel)]="newClient.name" class="form-control" placeholder="Company name" required>
        </div>
        <div class="form-group">
          <label>Industry *</label>
          <select [(ngModel)]="newClient.industry" class="form-control" required>
            <option value="">Select industry</option>
            <option value="Technology">Technology</option>
            <option value="Finance">Finance</option>
            <option value="Healthcare">Healthcare</option>
            <option value="Retail">Retail</option>
            <option value="Education">Education</option>
            <option value="Manufacturing">Manufacturing</option>
            <option value="Other">Other</option>
          </select>
        </div>
        <div class="form-group">
          <label>Contact Person</label>
          <input type="text" [(ngModel)]="newClient.contact" class="form-control" placeholder="Contact name">
        </div>
        <div class="form-group">
          <label>Email *</label>
          <input type="email" [(ngModel)]="newClient.email" class="form-control" placeholder="contact@company.com" required>
        </div>
        <div class="form-group">
          <label>Phone</label>
          <input type="tel" [(ngModel)]="newClient.phone" class="form-control" placeholder="+1 (555) 123-4567">
        </div>
        <div class="form-group">
          <label>Address</label>
          <input type="text" [(ngModel)]="newClient.address" class="form-control" placeholder="Company address">
        </div>
        <div class="form-group">
          <label>Website</label>
          <input type="url" [(ngModel)]="newClient.website" class="form-control" placeholder="https://company.com">
        </div>
        <div class="form-group">
          <label>About</label>
          <textarea [(ngModel)]="newClient.description" class="form-control" rows="3" placeholder="Company description"></textarea>
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn-secondary" (click)="closeAddModal()">Cancel</button>
        <button class="btn-primary" (click)="saveClient()">Add Client</button>
      </div>
    </div>
  </div>

  <!-- Documents Modal -->
  <div class="modal-overlay" *ngIf="showDocumentsModal" (click)="closeDocumentsModal()">
    <div class="modal" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h2>Documents for {{ selectedClient?.name }}</h2>
        <button class="close-btn" (click)="closeDocumentsModal()">âœ•</button>
      </div>
      <div class="modal-body">
        <p>This feature will show:</p>
        <ul>
          <li>Contracts</li>
          <li>Agreements</li>
          <li>Invoices</li>
          <li>Other documents</li>
        </ul>
        <p style="color: #64748b; margin-top: 1rem;">Document management coming soon...</p>
      </div>
      <div class="modal-footer">
        <button class="btn-secondary" (click)="closeDocumentsModal()">Close</button>
      </div>
    </div>
  </div>

  <!-- Deactivate Confirmation Modal -->
  <div class="modal-overlay" *ngIf="showDeactivateModal" (click)="closeDeactivateModal()">
    <div class="modal" (click)="$event.stopPropagation()" style="max-width: 400px;">
      <div class="modal-header">
        <h2>Deactivate Client</h2>
        <button class="close-btn" (click)="closeDeactivateModal()">âœ•</button>
      </div>
      <div class="modal-body">
        <p>Are you sure you want to deactivate <strong>{{ selectedClient?.name }}</strong>?</p>
        <p style="color: #64748b; font-size: 0.875rem; margin-top: 1rem;">This client will be marked as inactive and won't appear in active client lists.</p>
      </div>
      <div class="modal-footer">
        <button class="btn-secondary" (click)="closeDeactivateModal()">Cancel</button>
        <button class="btn-primary" style="background: #dc2626;" (click)="confirmDeactivate()">Deactivate</button>
      </div>
    </div>
  </div>

  <!-- Contracts Modal -->
  <div class="modal-overlay" *ngIf="showContractsModal" (click)="closeContractsModal()">
    <div class="modal" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h2>Contracts for {{ selectedClient?.name }}</h2>
        <button class="close-btn" (click)="closeContractsModal()">âœ•</button>
      </div>
      <div class="modal-body">
        <p>This feature will show:</p>
        <ul>
          <li>Active contracts</li>
          <li>Contract history</li>
          <li>Terms & conditions</li>
          <li>Renewal dates</li>
        </ul>
        <p style="color: #64748b; margin-top: 1rem;">Contract management coming soon...</p>
      </div>
      <div class="modal-footer">
        <button class="btn-secondary" (click)="closeContractsModal()">Close</button>
      </div>
    </div>
  </div>

  <!-- Toast Notification -->
  <div class="toast" [class.show]="showToast" [class.success]="toastType === 'success'" [class.error]="toastType === 'error'">
    {{ toastMessage }}
  </div>
</div>
