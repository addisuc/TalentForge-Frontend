<div class="client-details-page">
  <div class="breadcrumb">
    <a routerLink="/clients">â† Back to Clients</a>
  </div>
  
  <div class="loading" *ngIf="loading">
    <p>Loading client details...</p>
  </div>

  <div class="header" *ngIf="!loading && client">
    <div class="client-info">
      <div class="logo">{{ getInitials(client.name) }}</div>
      <div>
        <h1>{{ client.name }}</h1>
        <p class="industry">{{ client.industry || 'Industry' }}</p>
      </div>
    </div>
    <div class="actions">
      <button class="btn-secondary" (click)="editClient()">âœï¸ Edit</button>
      <button class="btn-secondary" (click)="contactClient()">âœ‰ï¸ Contact</button>
      <button class="btn-secondary" (click)="addNote()">ğŸ“ Add Note</button>
      <button class="btn-primary" (click)="createJob()">â• New Job</button>
    </div>
  </div>

  <div class="stats-grid">
    <div class="stat-card" *ngFor="let stat of stats">
      <span class="icon">{{ stat.icon }}</span>
      <div>
        <div class="value">{{ stat.value }}</div>
        <div class="label">{{ stat.label }}</div>
      </div>
    </div>
  </div>

  <div class="content-grid">
    <div class="main-content">
      <div class="section">
        <h2>About</h2>
        <p>{{ client.description }}</p>
      </div>

      <div class="section">
        <div class="section-header">
          <h2>Job Orders ({{ jobs.length }})</h2>
        </div>
        <div class="jobs-list" *ngIf="jobs.length > 0">
          <div class="job-item" *ngFor="let job of jobs" (click)="viewJob(job.id)" style="cursor: pointer;">
            <div class="job-info">
              <h3>{{ job.title }}</h3>
              <span class="meta">{{ getApplicationCount(job.id) }} applications â€¢ Posted {{ job.createdAt | date:'MMM d, yyyy' }}</span>
            </div>
            <span class="status" [class.active]="job.status === 'OPEN' || job.status === 'ACTIVE'">{{ job.status }}</span>
          </div>
        </div>
        <p *ngIf="jobs.length === 0" class="empty-state">No jobs posted for this client yet.</p>
      </div>
      
      <div class="section">
        <div class="section-header">
          <h2>Notes ({{ notes.length }})</h2>
        </div>
        <div class="notes-list" *ngIf="notes.length > 0">
          <div class="note-item" *ngFor="let note of notes">
            <p class="note-text">{{ note.note }}</p>
            <span class="note-date">{{ note.createdAt | date:'MMM d, yyyy h:mm a' }}</span>
          </div>
        </div>
        <p *ngIf="notes.length === 0" class="empty-state">No notes yet. Click "Add Note" to add one.</p>
      </div>

      <div class="section">
        <h2>Recent Hires ({{ recentHires.length }})</h2>
        <div class="hires-list" *ngIf="recentHires.length > 0">
          <div class="hire-item" *ngFor="let hire of recentHires">
            <span class="avatar">{{ hire.avatar }}</span>
            <div class="hire-info">
              <div class="name">{{ hire.name }}</div>
              <div class="position">{{ hire.position }}</div>
            </div>
            <span class="date">{{ hire.date | date:'MMM d, yyyy' }}</span>
          </div>
        </div>
        <p *ngIf="recentHires.length === 0" class="empty-state">No hires yet.</p>
      </div>

      <div class="section">
        <h2>Activity Timeline</h2>
        <div class="timeline" *ngIf="activities.length > 0">
          <div class="timeline-item" *ngFor="let activity of activities">
            <span class="timeline-icon">{{ activity.icon }}</span>
            <div class="timeline-content">
              <div class="timeline-header">
                <strong>{{ activity.title }}</strong>
                <span class="timeline-date">{{ activity.date | date:'MMM d, yyyy h:mm a' }}</span>
              </div>
              <p class="timeline-description">{{ activity.description }}</p>
            </div>
          </div>
        </div>
        <p *ngIf="activities.length === 0" class="empty-state">No activity yet.</p>
      </div>
    </div>

    <div class="sidebar">
      <div class="info-card">
        <h3>Contact Information</h3>
        <div class="info-item">
          <span class="icon">ğŸ‘¤</span>
          <div>
            <div class="label">Primary Contact</div>
            <div class="value">{{ client.contactPerson || client.contact }}</div>
          </div>
        </div>
        <div class="info-item">
          <span class="icon">âœ‰ï¸</span>
          <div>
            <div class="label">Email</div>
            <div class="value">{{ client.email }}</div>
          </div>
        </div>
        <div class="info-item">
          <span class="icon">ğŸ“</span>
          <div>
            <div class="label">Phone</div>
            <div class="value">{{ client.phone }}</div>
          </div>
        </div>
        <div class="info-item">
          <span class="icon">ğŸŒ</span>
          <div>
            <div class="label">Website</div>
            <div class="value">{{ client.website }}</div>
          </div>
        </div>
        <div class="info-item">
          <span class="icon">ğŸ“</span>
          <div>
            <div class="label">Address</div>
            <div class="value">{{ client.address }}</div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Email Modal -->
  <div class="modal-overlay" *ngIf="showEmailModal" (click)="closeEmailModal()">
    <div class="modal" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h2>Send Email to {{ client?.name }}</h2>
        <button class="close-btn" (click)="closeEmailModal()">âœ•</button>
      </div>
      <div class="modal-body">
        <div class="form-group">
          <label>To</label>
          <input type="email" [value]="client?.email" class="form-control" readonly>
        </div>
        <div class="form-group">
          <label>Subject *</label>
          <input type="text" [(ngModel)]="emailSubject" class="form-control" placeholder="Email subject">
        </div>
        <div class="form-group">
          <label>Message *</label>
          <textarea [(ngModel)]="emailBody" class="form-control" rows="8" placeholder="Enter your message..."></textarea>
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn-secondary" (click)="closeEmailModal()">Cancel</button>
        <button class="btn-primary" (click)="sendEmail()" [disabled]="sending">{{ sending ? 'Sending...' : 'Send Email' }}</button>
      </div>
    </div>
  </div>

  <!-- Add Note Modal -->
  <div class="modal-overlay" *ngIf="showNoteModal" (click)="closeNoteModal()">
    <div class="modal" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h2>Add Note</h2>
        <button class="close-btn" (click)="closeNoteModal()">âœ•</button>
      </div>
      <div class="modal-body">
        <div class="form-group">
          <label>Note *</label>
          <textarea [(ngModel)]="noteText" class="form-control" rows="6" placeholder="Enter your note about this client..."></textarea>
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn-secondary" (click)="closeNoteModal()">Cancel</button>
        <button class="btn-primary" (click)="saveNote()">Save Note</button>
      </div>
    </div>
  </div>

  <!-- Toast Notification -->
  <div class="toast" [class.show]="showToast" [class.success]="toastType === 'success'" [class.error]="toastType === 'error'">
    {{ toastMessage }}
  </div>
</div>
