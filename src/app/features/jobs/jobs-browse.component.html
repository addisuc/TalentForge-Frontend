<div class="jobs-browse">
  <div class="page-header">
    <div>
      <h1>Browse Jobs</h1>
      <p class="subtitle">{{ totalJobs }} active positions available</p>
    </div>
    <button class="btn-primary" (click)="openPostModal()">+ Post New Job</button>
  </div>

  <div class="filters-section">
    <div class="search-box">
      <span class="icon">üîç</span>
      <input type="text" placeholder="Search by title, skills, or company..." [(ngModel)]="searchQuery" (keyup.enter)="onSearch()">
    </div>
    <div class="filters">
      <select class="filter-select" [(ngModel)]="selectedClient" (change)="onFilterChange()">
        <option value="all">All Clients</option>
        <option *ngFor="let client of clients" [value]="client.id">{{ client.name }}</option>
      </select>
      <select class="filter-select" [(ngModel)]="selectedType" (change)="onFilterChange()">
        <option value="all">All Types</option>
        <option value="full-time">Full Time</option>
        <option value="contract">Contract</option>
        <option value="remote">Remote</option>
      </select>
      <select class="filter-select" [(ngModel)]="selectedPosition" (change)="onFilterChange()">
        <option value="all">All Positions</option>
        <option value="Developer">Developer</option>
        <option value="Manager">Manager</option>
        <option value="Designer">Designer</option>
      </select>
      <select class="filter-select" [(ngModel)]="selectedLocation" (change)="onFilterChange()">
        <option value="all">All Locations</option>
        <option value="Remote">Remote</option>
        <option value="San Francisco">San Francisco</option>
        <option value="New York">New York</option>
      </select>
      <select class="filter-select" [(ngModel)]="selectedStatus" (change)="onFilterChange()">
        <option value="all">All Status</option>
        <option value="ACTIVE">Active</option>
        <option value="DRAFT">Draft</option>
        <option value="CANCELLED">Cancelled</option>
      </select>
    </div>
  </div>

  <div class="table-container">
    <table class="data-table">
      <thead>
        <tr>
          <th (click)="sortBy('title')">Job Title</th>
          <th (click)="sortBy('company')">Client</th>
          <th (click)="sortBy('location')">Location</th>
          <th (click)="sortBy('type')">Type</th>
          <th (click)="sortBy('salary')">Salary</th>
          <th (click)="sortBy('status')">Status</th>
          <th (click)="sortBy('applicants')">Applicants</th>
          <th (click)="sortBy('postedDays')">Posted</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let job of paginatedJobs" (click)="viewJob(job.id)">
          <td>
            <div class="job-title-cell">
              <strong>{{ job.title }}</strong>
              <div class="skills-inline">
                <span class="skill-tag" *ngFor="let skill of getJobSkills(job).slice(0, 2)">{{ skill }}</span>
              </div>
            </div>
          </td>
          <td>{{ getCompanyName(job) }}</td>
          <td>{{ getLocationString(job) }}</td>
          <td><span class="badge" [class]="getJobTypeClass(job)">{{ getJobTypeDisplay(job) }}</span></td>
          <td>{{ getSalaryRange(job) }}</td>
          <td><span class="badge" [class]="'status-' + job.status.toLowerCase()">{{ job.status }}</span></td>
          <td>{{ getApplicantCount(job) }}</td>
          <td>{{ getDaysAgo(job.createdAt) }}d ago</td>
          <td>
            <button class="btn-action" (click)="viewJobDetails($event, job.id)">View</button>
            <button class="btn-action secondary" (click)="editJobDetails($event, job)">Edit</button>
            <button class="btn-action success" *ngIf="job.status === 'DRAFT'" (click)="activateJob($event, job.id)">Activate</button>
            <button class="btn-action danger" (click)="deleteJobDetails($event, job.id)">Delete</button>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="pagination">
    <div class="pagination-info">
      Showing {{ startIndex + 1 }} to {{ endIndex }} of {{ totalJobs }} jobs
    </div>
    <div class="pagination-controls">
      <select [(ngModel)]="itemsPerPage" (change)="onItemsPerPageChange()">
        <option [value]="25">25 per page</option>
        <option [value]="50">50 per page</option>
        <option [value]="100">100 per page</option>
      </select>
      <button [disabled]="currentPage === 1" (click)="previousPage()">Previous</button>
      <span class="page-numbers">
        <button *ngFor="let page of pageNumbers" 
                [class.active]="page === currentPage" 
                (click)="goToPage(page)">{{ page }}</button>
      </span>
      <button [disabled]="currentPage === totalPages" (click)="nextPage()">Next</button>
    </div>
  </div>

  <div class="modal-overlay" *ngIf="showPostModal" (click)="closePostModal()">
    <div class="modal large-modal" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h2>{{ editingJob ? 'Edit Job' : 'Post New Job' }}</h2>
        <button class="close-btn" (click)="closePostModal()">‚úï</button>
      </div>
      <div class="modal-body">
        <div class="progress-steps">
          <div class="step" [class.active]="currentStep >= 1" [class.completed]="currentStep > 1">
            <div class="step-number">1</div>
            <span>Basic Info</span>
          </div>
          <div class="step" [class.active]="currentStep >= 2" [class.completed]="currentStep > 2">
            <div class="step-number">2</div>
            <span>Details</span>
          </div>
          <div class="step" [class.active]="currentStep >= 3" [class.completed]="currentStep > 3">
            <div class="step-number">3</div>
            <span>Requirements</span>
          </div>
          <div class="step" [class.active]="currentStep >= 4">
            <div class="step-number">4</div>
            <span>Review</span>
          </div>
        </div>

        <div class="step-content" *ngIf="currentStep === 1">
          <h3>Basic Information</h3>
          <div class="form-group">
            <label>Job Title *</label>
            <input type="text" [(ngModel)]="jobData.title" class="form-control" placeholder="e.g. Senior Full Stack Developer">
          </div>
          <div class="form-row">
            <div class="form-group">
              <label>Client Company *</label>
              <select [(ngModel)]="jobData.clientId" class="form-control">
                <option value="">Select client</option>
                <option *ngFor="let client of clients" [value]="client.id">{{ client.name }}</option>
              </select>
            </div>
            <div class="form-group">
              <label>Department</label>
              <input type="text" [(ngModel)]="jobData.department" class="form-control" placeholder="e.g. Engineering">
            </div>
          </div>
          <div class="form-row">
            <div class="form-group">
              <label>Location *</label>
              <input type="text" [(ngModel)]="jobData.location" class="form-control" placeholder="e.g. San Francisco, CA">
            </div>
            <div class="form-group">
              <label>Job Type *</label>
              <select [(ngModel)]="jobData.type" class="form-control">
                <option value="full-time">Full Time</option>
                <option value="contract">Contract</option>
                <option value="remote">Remote</option>
              </select>
            </div>
          </div>
        </div>

        <div class="step-content" *ngIf="currentStep === 2">
          <h3>Job Details</h3>
          <div class="form-group">
            <label>Job Description *</label>
            <textarea [(ngModel)]="jobData.description" class="form-control" rows="8" placeholder="Describe the role, responsibilities, and what makes this opportunity great..."></textarea>
          </div>
          <div class="form-row">
            <div class="form-group">
              <label>Salary Range</label>
              <input type="text" [(ngModel)]="jobData.salaryMin" class="form-control" placeholder="Min (e.g. 120000)">
            </div>
            <div class="form-group">
              <label>&nbsp;</label>
              <input type="text" [(ngModel)]="jobData.salaryMax" class="form-control" placeholder="Max (e.g. 180000)">
            </div>
          </div>
          <div class="form-group">
            <label>Benefits</label>
            <textarea [(ngModel)]="jobData.benefits" class="form-control" rows="4" placeholder="Health insurance, 401k, flexible hours, etc."></textarea>
          </div>
        </div>

        <div class="step-content" *ngIf="currentStep === 3">
          <h3>Requirements</h3>
          <div class="form-group">
            <label>Required Skills *</label>
            <input type="text" [(ngModel)]="skillInput" (keyup.enter)="addSkill()" class="form-control" placeholder="Type skill and press Enter">
            <div class="skills-list">
              <span class="skill-tag" *ngFor="let skill of jobData.skills">
                {{ skill }}
                <button (click)="removeSkill(skill)">√ó</button>
              </span>
            </div>
          </div>
          <div class="form-group">
            <label>Experience Level *</label>
            <select [(ngModel)]="jobData.experienceLevel" class="form-control">
              <option value="entry">Entry Level (0-2 years)</option>
              <option value="mid">Mid Level (3-5 years)</option>
              <option value="senior">Senior Level (6+ years)</option>
            </select>
          </div>
          <div class="form-group">
            <label>Education</label>
            <select [(ngModel)]="jobData.education" class="form-control">
              <option value="">Not specified</option>
              <option value="bachelors">Bachelor's Degree</option>
              <option value="masters">Master's Degree</option>
              <option value="phd">PhD</option>
            </select>
          </div>
        </div>

        <div class="step-content" *ngIf="currentStep === 4">
          <h3>Review & Publish</h3>
          <div class="review-section">
            <h4>{{ jobData.title }}</h4>
            <p class="review-meta">{{ jobData.location }} ‚Ä¢ {{ jobData.type }}</p>
            <div class="review-item">
              <strong>Description:</strong>
              <p>{{ jobData.description }}</p>
            </div>
            <div class="review-item" *ngIf="jobData.salaryMin || jobData.salaryMax">
              <strong>Salary:</strong>
              <p>${{ jobData.salaryMin }} - ${{ jobData.salaryMax }}</p>
            </div>
            <div class="review-item">
              <strong>Skills:</strong>
              <div class="skills-list">
                <span class="skill-tag" *ngFor="let skill of jobData.skills">{{ skill }}</span>
              </div>
            </div>
          </div>
        </div>

        <div *ngIf="error" class="error-message">{{ error }}</div>
      </div>
      <div class="modal-footer">
        <button class="btn-secondary" (click)="closePostModal()">Cancel</button>
        <button class="btn-secondary" *ngIf="currentStep > 1" (click)="previousStep()">‚Üê Previous</button>
        <button class="btn-primary" *ngIf="currentStep < 4" (click)="nextStep()">Next ‚Üí</button>
        <button class="btn-primary" *ngIf="currentStep === 4" (click)="postJob()" [disabled]="loading">{{ loading ? 'Publishing...' : 'Publish Job' }}</button>
      </div>
    </div>
  </div>

  <!-- View Job Modal -->
  <div class="modal-overlay" *ngIf="showViewModal" (click)="closeViewModal()">
    <div class="modal" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h2>Job Details</h2>
        <button class="close-btn" (click)="closeViewModal()">‚úï</button>
      </div>
      <div class="modal-body" *ngIf="viewingJob">
        <div class="job-detail-grid">
          <div class="detail-item">
            <label>Job Title</label>
            <div class="detail-value">{{ viewingJob.title }}</div>
          </div>
          <div class="detail-item">
            <label>Company</label>
            <div class="detail-value">{{ getCompanyName(viewingJob) }}</div>
          </div>
          <div class="detail-item">
            <label>Location</label>
            <div class="detail-value">{{ getLocationString(viewingJob) }}</div>
          </div>
          <div class="detail-item">
            <label>Job Type</label>
            <div class="detail-value">{{ getJobTypeDisplay(viewingJob) }}</div>
          </div>
          <div class="detail-item">
            <label>Salary Range</label>
            <div class="detail-value">{{ getSalaryRange(viewingJob) }}</div>
          </div>
          <div class="detail-item full-width">
            <label>Description</label>
            <div class="detail-value description">{{ viewingJob.description }}</div>
          </div>
          <div class="detail-item full-width" *ngIf="viewingJob.requirements">
            <label>Requirements</label>
            <div class="detail-value">{{ viewingJob.requirements }}</div>
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn-secondary" (click)="closeViewModal()">Close</button>
        <button class="btn-primary" (click)="editFromView()">Edit Job</button>
      </div>
    </div>
  </div>

  <!-- Delete Confirmation Modal -->
  <div class="modal-overlay" *ngIf="showDeleteModal" (click)="closeDeleteModal()">
    <div class="modal delete-modal" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h2>Delete Job</h2>
        <button class="close-btn" (click)="closeDeleteModal()">‚úï</button>
      </div>
      <div class="modal-body" *ngIf="deletingJob">
        <div class="delete-warning">
          <div class="warning-icon">‚ö†Ô∏è</div>
          <div class="warning-text">
            <p>Are you sure you want to delete this job?</p>
            <p class="job-title">"{{ deletingJob.title }}"</p>
            <p class="warning-note">This action cannot be undone.</p>
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn-secondary" (click)="closeDeleteModal()">Cancel</button>
        <button class="btn-danger" [disabled]="loading" (click)="confirmDelete()">
          {{ loading ? 'Deleting...' : 'Delete Job' }}
        </button>
      </div>
    </div>
  </div>
</div>
