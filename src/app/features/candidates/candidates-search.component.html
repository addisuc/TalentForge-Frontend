<div class="candidates-search">
  <div class="notification" *ngIf="notification.show" [class.success]="notification.type === 'success'" [class.error]="notification.type === 'error'">
    {{ notification.message }}
  </div>
  <div class="page-header">
    <div>
      <h1>Candidate Database</h1>
      <p class="subtitle">{{ totalCandidates }} candidates in database</p>
    </div>
    <button class="btn-primary" (click)="openAddModal()">+ Add Candidate</button>
  </div>

  <div class="search-section">
    <div class="search-bar">
      <span class="icon">ğŸ”</span>
      <input type="text" [(ngModel)]="searchQuery" placeholder="Search by name, skills, or experience...">
    </div>
    <div class="filters">
      <select class="filter-select" [(ngModel)]="selectedPosition" (change)="onFilterChange()">
        <option value="all">All Positions</option>
        <option value="Developer">Developer</option>
        <option value="Manager">Manager</option>
        <option value="Designer">Designer</option>
      </select>
      <select class="filter-select" [(ngModel)]="selectedLocation" (change)="onFilterChange()">
        <option value="all">All Locations</option>
        <option value="San Francisco">San Francisco</option>
        <option value="New York">New York</option>
        <option value="Remote">Remote</option>
      </select>
      <select class="filter-select" [(ngModel)]="selectedExperience" (change)="onFilterChange()">
        <option value="all">All Experience</option>
        <option value="0-2">0-2 years</option>
        <option value="3-5">3-5 years</option>
        <option value="6-10">6-10 years</option>
        <option value="10+">10+ years</option>
      </select>
      <select class="filter-select" [(ngModel)]="selectedStatus" (change)="onFilterChange()">
        <option value="all">All Status</option>
        <option value="Available">Available</option>
        <option value="Interviewing">Interviewing</option>
        <option value="Placed">Placed</option>
      </select>
    </div>
  </div>

  <div class="table-container">
    <table class="data-table">
      <thead>
        <tr>
          <th>Name</th>
          <th>Position</th>
          <th>Location</th>
          <th>Experience</th>
          <th>Salary</th>
          <th>Status</th>
          <th>Skills</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let candidate of paginatedCandidates" (click)="viewCandidate(candidate.id)">
          <td>
            <div class="name-cell">
              <span class="avatar">{{ candidate.initials }}</span>
              <strong>{{ candidate.name }}</strong>
            </div>
          </td>
          <td>{{ candidate.role }}</td>
          <td>{{ candidate.location }}</td>
          <td>{{ candidate.experience }} years</td>
          <td>{{ candidate.salary }}</td>
          <td><span class="badge" [class]="candidate.status.toLowerCase()">{{ candidate.status }}</span></td>
          <td>
            <div class="skills-inline">
              <span class="skill-tag" *ngFor="let skill of candidate.skills.slice(0, 2)">{{ skill }}</span>
              <span class="skill-tag more" *ngIf="candidate.skills.length > 2">+{{ candidate.skills.length - 2 }}</span>
            </div>
          </td>
          <td>
            <div class="action-buttons">
              <button class="btn-action" (click)="viewCandidate(candidate.id); $event.stopPropagation()" title="View Profile">ğŸ‘¤</button>
              <button class="btn-action" (click)="contactCandidate(candidate.id); $event.stopPropagation()" title="Send Email">âœ‰ï¸</button>
              <button class="btn-action" (click)="addToJob(candidate.id); $event.stopPropagation()" title="Add to Job">â•</button>
              <button class="btn-action" (click)="downloadResume(candidate.id); $event.stopPropagation()" title="Download Resume">ğŸ“„</button>
            </div>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="pagination">
    <div class="pagination-info">
      Showing {{ startIndex + 1 }} to {{ endIndex }} of {{ totalCandidates }} candidates
    </div>
    <div class="pagination-controls">
      <select [(ngModel)]="itemsPerPage" (change)="onItemsPerPageChange()">
        <option [value]="25">25 per page</option>
        <option [value]="50">50 per page</option>
        <option [value]="100">100 per page</option>
      </select>
      <button [disabled]="currentPage === 1" (click)="previousPage()">Previous</button>
      <span class="page-numbers">
        <button *ngFor="let page of pageNumbers" 
                [class.active]="page === currentPage" 
                (click)="goToPage(page)">{{ page }}</button>
      </span>
      <button [disabled]="currentPage === totalPages" (click)="nextPage()">Next</button>
    </div>
  </div>

  <!-- View Candidate Modal -->
  <div class="modal-overlay" *ngIf="showViewModal" (click)="closeViewModal()">
    <div class="modal" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h2>Candidate Profile</h2>
        <button class="close-btn" (click)="closeViewModal()">âœ•</button>
      </div>
      <div class="modal-body" *ngIf="selectedCandidate">
        <div class="profile-section">
          <div class="avatar-large">{{ selectedCandidate.initials }}</div>
          <h3>{{ selectedCandidate.name }}</h3>
          <p class="role">{{ selectedCandidate.role }}</p>
          <span class="badge" [class]="selectedCandidate.status.toLowerCase()">{{ selectedCandidate.status }}</span>
          <p class="last-active">Last active {{ selectedCandidate.lastActive }} days ago</p>
        </div>
        
        <div class="info-section">
          <h4>ğŸ“ Contact Information</h4>
          <div class="info-row">
            <span class="label">Email:</span>
            <span class="value">{{ selectedCandidate.name.toLowerCase().split(' ').join('.') }}&#64;example.com</span>
          </div>
          <div class="info-row">
            <span class="label">Phone:</span>
            <span class="value">+1 (555) 123-4567</span>
          </div>
          <div class="info-row">
            <span class="label">Location:</span>
            <span class="value">{{ selectedCandidate.location }}</span>
          </div>
        </div>

        <div class="info-section">
          <h4>ğŸ’¼ Professional Details</h4>
          <div class="info-row">
            <span class="label">Experience:</span>
            <span class="value">{{ selectedCandidate.experience }} years</span>
          </div>
          <div class="info-row">
            <span class="label">Salary Expectation:</span>
            <span class="value">{{ selectedCandidate.salary }}</span>
          </div>
          <div class="info-row">
            <span class="label">Availability:</span>
            <span class="value">Immediate</span>
          </div>
        </div>

        <div class="info-section">
          <h4>ğŸ› ï¸ Skills & Expertise</h4>
          <div class="skills-grid">
            <span class="skill-tag" *ngFor="let skill of selectedCandidate.skills">{{ skill }}</span>
          </div>
        </div>

        <div class="info-section">
          <h4>ğŸ“„ Resume</h4>
          <div class="resume-actions">
            <a *ngIf="selectedCandidate.resumeUrl" [href]="selectedCandidate.resumeUrl" target="_blank" class="btn-secondary">ğŸ‘ï¸ Preview Resume</a>
            <button class="btn-secondary" (click)="downloadResume(selectedCandidate.id)">ğŸ“¥ Download Resume</button>
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn-secondary" (click)="closeViewModal()">Close</button>

        <button class="btn-primary" (click)="closeViewModal(); contactCandidate(selectedCandidate.id)">âœ‰ï¸ Send Email</button>
      </div>
    </div>
  </div>

  <!-- Contact Candidate Modal -->
  <div class="modal-overlay" *ngIf="showContactModal" (click)="closeContactModal()">
    <div class="modal" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h2>Contact Candidate</h2>
        <button class="close-btn" (click)="closeContactModal()">âœ•</button>
      </div>
      <div class="modal-body" *ngIf="selectedCandidate">
        <p>Send email to <strong>{{ selectedCandidate.name }}</strong></p>
        <div class="form-group">
          <label>Subject</label>
          <input type="text" [(ngModel)]="emailSubject" class="form-control" placeholder="Job Opportunity">
        </div>
        <div class="form-group">
          <label>Message</label>
          <textarea [(ngModel)]="emailMessage" class="form-control" rows="6" placeholder="Hi {{ selectedCandidate.name }}, I have an exciting opportunity..."></textarea>
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn-secondary" (click)="closeContactModal()">Cancel</button>
        <button class="btn-primary" (click)="sendEmail()" type="button">Send Email</button>
      </div>
    </div>
  </div>

  <!-- Schedule Interview Modal -->
  <div class="modal-overlay" *ngIf="showScheduleModal" (click)="closeScheduleModal()">
    <div class="modal" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h2>Schedule Interview</h2>
        <button class="close-btn" (click)="closeScheduleModal()">âœ•</button>
      </div>
      <div class="modal-body" *ngIf="selectedCandidate">
        <p>Schedule interview with <strong>{{ selectedCandidate.name }}</strong></p>
        <div class="form-group">
          <label>Interview Type</label>
          <select [(ngModel)]="interviewType" class="form-control">
            <option value="PHONE">Phone Screen</option>
            <option value="VIDEO">Video Interview</option>
            <option value="ONSITE">On-site Interview</option>
          </select>
        </div>
        <div class="form-group">
          <label>Date & Time</label>
          <input type="datetime-local" [(ngModel)]="interviewDateTime" class="form-control">
        </div>
        <div class="form-group">
          <label>Meeting Link (Optional)</label>
          <input type="url" [(ngModel)]="interviewMeetingLink" class="form-control" placeholder="https://zoom.us/j/...">
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn-secondary" (click)="closeScheduleModal()">Cancel</button>
        <button class="btn-primary" [disabled]="!interviewDateTime" (click)="createInterview()">Schedule</button>
      </div>
    </div>
  </div>

  <!-- Add to Job Modal -->
  <div class="modal-overlay" *ngIf="showAddToJobModal" (click)="closeAddToJobModal()">
    <div class="modal" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h2>Add to Job</h2>
        <button class="close-btn" (click)="closeAddToJobModal()">âœ•</button>
      </div>
      <div class="modal-body" *ngIf="selectedCandidate">
        <p>Add <strong>{{ selectedCandidate.name }}</strong> to a job opening</p>
        <div class="form-group">
          <label>Select Job</label>
          <select [(ngModel)]="selectedJobId" class="form-control">
            <option value="">-- Select a job --</option>
            <option *ngFor="let job of availableJobs" [value]="job.id">{{ job.title }} - {{ job.clientName || 'Internal' }}</option>
          </select>
        </div>
        <div class="form-group">
          <label>Notes (Optional)</label>
          <textarea [(ngModel)]="applicationNotes" class="form-control" rows="3" placeholder="Add any notes about this candidate..."></textarea>
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn-secondary" (click)="closeAddToJobModal()">Cancel</button>
        <button class="btn-primary" [disabled]="!selectedJobId" (click)="submitApplication()">Add to Job</button>
      </div>
    </div>
  </div>

  <!-- Add Candidate Modal -->
  <div class="modal-overlay" *ngIf="showAddModal" (click)="closeAddModal()">
    <div class="modal" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h2>Add Candidate</h2>
        <button class="close-btn" (click)="closeAddModal()">âœ•</button>
      </div>
      <div class="modal-body">
        <div class="form-group">
          <label>Full Name *</label>
          <input type="text" [(ngModel)]="candidateName" class="form-control" placeholder="John Doe">
        </div>
        <div class="form-group">
          <label>Email Address *</label>
          <input type="email" [(ngModel)]="candidateEmail" (blur)="onEmailBlur()" class="form-control" [class.error]="emailTouched && !isValidEmail()" placeholder="john@example.com">
          <p class="error-text" *ngIf="emailTouched && !isValidEmail()">Please enter a valid email address</p>
        </div>
        <div class="form-group">
          <label>Phone Number</label>
          <input type="tel" [(ngModel)]="candidatePhone" class="form-control" placeholder="(555) 123-4567">
        </div>
        <div class="form-group">
          <label>Position/Title</label>
          <input type="text" [(ngModel)]="candidatePosition" class="form-control" placeholder="Senior Software Engineer">
        </div>
        <div class="form-group">
          <label>Skills</label>
          <input type="text" [(ngModel)]="candidateSkills" class="form-control" placeholder="React, Node.js, TypeScript">
          <p class="help-text">Comma-separated list of skills</p>
        </div>
        <div class="form-group">
          <label>Resume</label>
          <input type="file" (change)="onFileSelect($event)" class="form-control" accept=".pdf,.doc,.docx">
          <p class="help-text">PDF, DOC, or DOCX format</p>
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn-secondary" (click)="closeAddModal()">Cancel</button>
        <button class="btn-primary" [disabled]="!candidateName || !isValidEmail()" (click)="addCandidate()">Add Candidate</button>
      </div>
    </div>
  </div>
</div>
